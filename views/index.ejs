<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorty | URL Shortener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #111827; /* bg-gray-900 */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" width="80" height="80"><path fill="rgba(255,255,255,0.04)" d="M40 40 L42 40 L42 42 L40 42 Z M50 50 L52 50 L52 52 L50 52 Z M20 60 L22 60 L22 62 L20 62 Z M70 10 L72 10 L72 12 L70 12 Z"></path></svg>');
        }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden; width: 100px; background-color: #1f2937; color: #fff; text-align: center;
            border-radius: 6px; padding: 5px 0; position: absolute; z-index: 1;
            bottom: 125%; left: 50%; margin-left: -50px; opacity: 0; transition: opacity 0.3s;
        }
        .tooltip .tooltiptext::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: #1f2937 transparent transparent transparent;
        }
        .tooltip.active .tooltiptext { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="text-white px-4 py-8 overflow-y-auto">
    <div class="w-full max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-12">
            <div class="flex items-center gap-2">
                <svg class="w-8 h-8 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                <h2 class="text-2xl font-bold">Shorty</h2>
            </div>
        </header>

        <!-- Main Content -->
        <div class="relative">
            <div class="absolute -left-24 -top-16 text-amber-500/50 opacity-50 hidden lg:block" style="transform: scaleX(-1);">
                <svg width="200" height="350" viewBox="0 0 137 236" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M136.219 100.32L42.1875 235.5L42.2275 135.88L0.78125 135.84L94.7725 0L94.7325 100.28L136.219 100.32Z" fill="currentColor"/></svg>
            </div>
            <div class="text-center mb-12">
                <h1 class="text-6xl font-extrabold text-white">Shorten your <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500">looooooong</span> URLs</h1>
                <p class="text-gray-400 mt-4 text-lg">Copy your long boring URL. Paste it below. Then âœ¨ You got it, right?!</p>
            </div>

            <!-- Form Card -->
            <div class="w-full max-w-2xl mx-auto p-8 bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-2xl ring-1 ring-white/10">
                <form action="/shorten" method="POST" class="flex flex-col gap-4">
                    <!-- Long URL input -->
                    <input type="url" id="longUrl" name="longUrl" class="w-full p-4 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none transition" placeholder="https://your-long-url.com/goes-here" required>

                    <!-- Custom code input inside the form -->
                    <div class="flex items-center">
                        <span class="p-3 bg-gray-700/50 border border-r-0 border-gray-600 rounded-l-lg text-gray-400 text-sm"><%= baseUrl.replace('http://', '').replace('https://', '') %>/</span>
                        <input type="text" id="customCode" name="customCode" class="w-full p-3 bg-gray-700/50 border border-gray-600 rounded-r-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none transition text-sm" placeholder="your-custom-name (optional)">
                    </div>

                    <!-- Submit button -->
                    <button type="submit" class="py-4 px-6 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition">Shorten URL</button>
                </form>
            </div>
        </div>

        <!-- Result/Error Display Area -->
        <div class="mt-16 text-center">
             <% if (error) { %>
                <div class="max-w-2xl mx-auto p-4 bg-red-900/50 text-red-300 ring-1 ring-red-500/30 rounded-lg"><p><%= error %></p></div>
            <% } %>

            <% if (url) { %>
                <h2 class="text-4xl font-bold text-white mb-6">Hoho!</h2>
                <p class="text-gray-400 mb-8">Here is your shortened URL! Now start rick-rolling your friends ðŸ˜‰</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- The newly created link card -->
                    <div class="bg-gray-800/60 ring-1 ring-amber-500/50 rounded-lg p-4 flex items-center justify-between transition-all">
                        <div class="text-left overflow-hidden">
                            <% const fullShortUrl = `${baseUrl}/${url.shortCode}` %>
                            <a href="<%= fullShortUrl %>" target="_blank" class="font-semibold text-lg text-amber-400 hover:text-amber-300 truncate block"><%= fullShortUrl %></a>
                            <p class="text-gray-400 text-sm truncate"><%= url.longUrl %></p> 
                        </div>
                        <div class="flex items-center space-x-2 flex-shrink-0">
                            <div class="flex items-center text-gray-400 text-sm" title="Click Count">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                <span><%= url.clickCount %></span>
                            </div>
                            <div class="tooltip">
                                 <button class="copy-button p-2 text-gray-400 hover:text-white rounded-md transition" data-copy-link="<%= fullShortUrl %>">
                                    <span class="tooltiptext">Copy link</span>
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>

    <script>
        document.body.addEventListener('click', function(event) {
            const copyButton = event.target.closest('.copy-button');
            if (copyButton) {
                const tooltip = copyButton.parentElement;
                const tooltipText = tooltip.querySelector('.tooltiptext');
                const linkToCopy = copyButton.dataset.copyLink;

                navigator.clipboard.writeText(linkToCopy).then(() => {
                    tooltipText.textContent = 'Copied!';
                    tooltip.classList.add('active');
                    setTimeout(() => {
                        tooltip.classList.remove('active');
                        tooltipText.textContent = 'Copy link';
                    }, 2000);
                }).catch(err => {
                    tooltipText.textContent = 'Failed!';
                    console.error('Failed to copy: ', err);
                });
            }
        });
    </script>
</body>
</html>
